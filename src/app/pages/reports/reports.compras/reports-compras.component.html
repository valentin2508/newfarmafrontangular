<div class="container-fluid">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Reporte de Compras</h3>
    </div>
    <div class="card-body">
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>ID Compra</th>
            <th>Serie</th>
            <th>Correlativo</th>
            <th>Fecha</th>
            <th>Total</th>
            <th>Proveedor</th>
            <th>Empleado</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let compra of agrupados">
            <tr (click)="toggleDetalles(compra.idcompra!)" style="cursor: pointer;"  class="prueba">
              <td>{{ compra.idcompra }}</td>
              <td>{{ compra.serie }}</td>
              <td>{{ compra.correlativo }}</td>
              <td>{{ compra.fechacompra | date: 'dd/MM/yyyy' }}</td>
              <td>S/ {{ compra.costocompra?.toFixed(2) }}</td>
              <td>{{ compra.proveedor.persona.nombre }}</td>
              <td>{{ compra.empleado?.persona.nombre }} {{ compra.empleado?.persona.paterno }}</td>
            </tr>
            <tr class="tbodys" *ngIf="selectedCompraId === compra.idcompra">
              <td colspan="7">
                <div *ngIf="detallesCompra[compra.idcompra!]">
                  <h5>Detalles de la Compra</h5>
                  <table class="table table-sm table-striped">
                    <thead>
                      <tr>
                        <th>Producto</th>
                        <th>Lote</th>
                        <th>Cantidad</th>
                        <th>Precio Unitario</th>
                        <th>Subtotal</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let detalle of detallesCompra[compra.idcompra!]">
                        <td>{{ detalle.producto.nombre }}</td>
                        <td>{{ detalle.lote }}</td>
                        <td>{{ detalle.unidades }}</td>
                        <td>S/ {{ detalle.costounidad.toFixed(2) }}</td>
                        <td>S/ {{ detalle.total.toFixed(2) }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
    <div class="card-footer">
      <div class="paginador">
        <button (click)="previoPage()" class="btn btn-primary btn-sm">&lt;</button>
        <app-paginate [total]="totalCompras" [npage]="pages" (SendIndex)="onPageChange($event)"></app-paginate>
        <button (click)="nextPage()" class="btn btn-primary btn-sm">&gt;</button>
      </div>
    </div>
  </div>
</div>